[tool.ruff]
# Exclude common directories
exclude = [
    ".git",
    ".venv",
    "venv",
    "__pycache__",
    "build",
    "dist",
    "output",
]

# Set the maximum line length
line-length = 88

# Target Python version
target-version = "py38"

[tool.ruff.lint]
# Enable pycodestyle (`E`) and Pyflakes (`F`) codes by default.
# Add other rule sets as needed:
# - `I` for isort (import sorting)
# - `N` for pep8-naming
# - `UP` for pyupgrade
# - `B` for flake8-bugbear
select = ["E", "F", "I", "N", "UP", "B"]

# Ignore specific rules if needed
ignore = []

# Allow autofix for all enabled rules (when `--fix`) is provided.
fixable = ["ALL"]
unfixable = []

[tool.ruff.format]
# Use double quotes for strings
quote-style = "double"

# Indent with spaces
indent-style = "space"

[tool.pytest.ini_options]
# Pytest Configuration for Dialplan Tests

# Test discovery patterns
python_files = "test_*.py"
python_classes = "Test*"
python_functions = "test_*"

# Minimum version
minversion = "7.0"

# Add current directory to Python path
pythonpath = ["tests"]

# Test output options
addopts = [
    # Verbose output
    "-v",
    # Show local variables in tracebacks
    "--showlocals",
    # Strict markers - fail if unknown marker used
    "--strict-markers",
    # Show summary of all test outcomes
    "-ra",
    # Capture warnings
    "-W", "default",
    # Increase verbosity for failures
    "--tb=short",
    "--cov=.",
    "--cov-report=term-missing",
]

# Test markers
markers = [
    "smoke: Quick smoke tests for basic functionality",
    "slow: Tests that take a long time to run",
    "integration: Integration tests requiring external services",
    "unit: Unit tests that don't require external dependencies",
]

# Logging
log_cli = false
log_cli_level = "INFO"
log_cli_format = "%(asctime)s [%(levelname)s] %(message)s"
log_cli_date_format = "%H:%M:%S"

log_file = "tests/pytest.log"
log_file_level = "DEBUG"
log_file_format = "%(asctime)s [%(levelname)s] [%(filename)s:%(lineno)d] %(message)s"
log_file_date_format = "%Y-%m-%d %H:%M:%S"

# Timeout for tests (prevent hanging)
# Requires pytest-timeout
timeout = 300
timeout_method = "thread"

[tool.coverage.run]
source = ["tests"]
omit = [
    "*/test_*.py",
    "*/conftest.py",
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "if TYPE_CHECKING:",
    "@abstractmethod",
]
